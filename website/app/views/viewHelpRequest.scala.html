@(user: models.User, helpRequest: models.frontend.FrontendHelpRequest, helpResponses: List[models.frontend.FrontendHelpResponse])
@main(helpRequest.title, "view-help-request") {
<!--
    Header
-->
@nav(Some(user), Some(helpRequest.title))

} {
<!--
    Content
-->

} {
<!--
    Javascript
-->
<script id="content-template" type="text/html">
    <section id="requester">
        <img src="/files/profile-pic/{{helpRequest.requester.id}}"/>

        <p>{{helpRequest.requester.firstName}} {{helpRequest.requester.lastName}}, aka
            "{{helpRequest.requester.username}}"</p>

        <p>Lives in {{helpRequest.requester.city}}, {{helpRequest.country.name}}</p>

        <div>
            <a href="/users/{{helpRequest.requester.username}}">View full profile</a>
        </div>

        @if(user.id.get != helpRequest.requester.id) {
        <div>
            <a href="/messages/new?to={{helpRequest.requester.username}}">Write message</a>
        </div>
        }
    </section>

    <section id="main">
        <section id="help-request" data-id="{{helpRequest.id}}">
            <h1>{{helpRequest.title}}</h1>

            <p>{{helpRequest.description}}</p>

            <p>
                <label>Submitted:</label>
                <span>{{helpRequest.creationDatetime}}</span>
            </p>

            <p>
                <label>Expires:</label>
                <span>{{helpRequest.expiryDate}}</span>
            </p>

            @if(user.id.get == helpRequest.requester.id) {
            <span>
                <a id="edit">Edit</a>
            </span>
            <span>
                <a id="delete">Delete</a>
            </span>
            }
        </section>

        <section id="responses">
            <h2>Responses</h2>

            {{#helpResponses}}
            <article>
                <img src="/files/profile-pic/{{responder.id}}"/>
                <span>{{creationDatetime}}</span>
                <span>{{responder.name}}</span>
                <span>{{responder.username}}</span>

                <p>{{text}}</p>
            </article>
            {{/helpResponses}}

        </section>

        @if(user.id.get != helpRequest.requester.id) {
        <div>
            <a id="respond">Respond to {{helpRequest.requester.firstName}}'s help request</a>
        </div>

        <form id="respond-form">
            <div class="field">
                <textarea id="response-text" placeholder="Your message *"></textarea>

                <p class="field-error" data-check="empty">Please respond to with a message</p>
            </div>

            <div id="submit-response-wrapper">
                <a id="post-response-button">
                    <span>Post response</span>
                </a>

                <a id="cancel-response-button">
                    <span>Cancel</span>
                </a>

                <input type="submit"/>
            </div>
        </form>

        <div>
            <a id="write-reference">Write a reference</a>
        </div>

        <form id="reference-form">
            <div class="field">
                <ul id="helped-or-was-helped" class="pills">
                    <li id="helped">
                        <a>Helped</a>
                    </li>
                    <li id="was-helped">
                        <a>Was helped</a>
                    </li>
                </ul>

                <p class="field-error" data-check="empty">Did you help, or were you helped?</p>
            </div>

            <div class="field">
                <label for="grade">Grade:</label><!--
             --><ul id="grade" class="pills">
                    <li data-grade-id="4">
                        <a>Great!</a>
                    </li>
                    <li data-grade-id="3">
                        <a>Nice</a>
                    </li>
                    <li data-grade-id="2">
                        <a>Neutral</a>
                    </li>
                    <li data-grade-id="1">
                        <a>Negative</a>
                    </li>
                </ul>

                <p class="field-error" data-check="empty">Please select a grade</p>
            </div>

            <div class="field">
                <textarea id="reference-text" placeholder="Your reference text *"></textarea>

                <p class="field-error" data-check="empty">Please explain how things went</p>
            </div>

            <div id="submit-reference-wrapper">
                <a id="post-reference-button">
                    <span>Save reference</span>
                </a>

                <a id="cancel-reference-button">
                    <span>Cancel</span>
                </a>

                <input type="submit"/>
            </div>
        </form>
        }
    </section>

</script>

<script type="text/javascript">
    window.addEvent("domready",function () {
        new CBR.Controllers.NavController().run();

        new CBR.Controllers.ViewHelpRequest({
            el: "#content",
            helpRequest: @Html(services.JsonUtil.serialize(helpRequest)),
            helpResponses: @Html(services.JsonUtil.serialize(helpResponses))
        }).run();
    });
</script>
}